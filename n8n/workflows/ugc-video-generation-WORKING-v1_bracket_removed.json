
  {
    "type": "text",
    "text": "{\n  \"success\": true,\n  \"data\": {\n    \"updatedAt\": \"2026-01-18T05:55:05.350Z\",\n    \"createdAt\": \"2026-01-17T07:45:26.419Z\",\n    \"id\": \"MTcFgM1Ym9WnYZ2Y\",\n    \"name\": \"UGC Video Generation - v1\",\n    \"description\": null,\n    \"active\": true,\n    \"isArchived\": false,\n    \"nodes\": [\n      {\n        \"parameters\": {\n          \"httpMethod\": \"POST\",\n          \"path\": \"ugc-video-generate\",\n          \"responseMode\": \"responseNode\",\n          \"options\": {}\n        },\n        \"id\": \"webhook-trigger\",\n        \"name\": \"Webhook Trigger\",\n        \"type\": \"n8n-nodes-base.webhook\",\n        \"typeVersion\": 2,\n        \"position\": [\n          256,\n          304\n        ],\n        \"webhookId\": \"ugc-video-generate\"\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"strict\"\n            },\n            \"combinator\": \"and\",\n            \"conditions\": [\n              {\n                \"id\": \"api-key-check\",\n                \"leftValue\": \"={{ $json.headers['x-api-key'] }}\",\n                \"rightValue\": \"nHChN19vbgeSPiDMkfQWsmZ3u2TcBK6y\",\n                \"operator\": {\n                  \"type\": \"string\",\n                  \"operation\": \"equals\"\n                }\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"validate-api-key\",\n        \"name\": \"Validate API Key\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          464,\n          304\n        ]\n      },\n      {\n        \"parameters\": {\n          \"respondWith\": \"json\",\n          \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Unauthorized\\\", \\\"message\\\": \\\"Invalid or missing X-API-Key header\\\" } }}\",\n          \"options\": {\n            \"responseCode\": 401\n          }\n        },\n        \"id\": \"respond-401\",\n        \"name\": \"Respond 401 Unauthorized\",\n        \"type\": \"n8n-nodes-base.respondToWebhook\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          704,\n          512\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const body = $input.first().json.body || {};\\nconst requiredFields = ['user_id', 'video_id', 'product_name', 'product_photo_url'];\\nconst missingFields = requiredFields.filter(field => {\\n  const value = body[field];\\n  return value === undefined || value === null || value === '';\\n});\\nreturn [{\\n  json: {\\n    ...$input.first().json,\\n    validation: { isValid: missingFields.length === 0, missingFields: missingFields }\\n  }\\n}];\"\n        },\n        \"id\": \"code-validate-fields\",\n        \"name\": \"Validate Fields\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          704,\n          208\n        ]\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"loose\"\n            },\n            \"combinator\": \"and\",\n            \"conditions\": [\n              {\n                \"id\": \"check-valid\",\n                \"leftValue\": \"={{ $json.validation.isValid }}\",\n                \"rightValue\": true,\n                \"operator\": {\n                  \"type\": \"boolean\",\n                  \"operation\": \"equals\"\n                }\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"if-fields-valid\",\n        \"name\": \"Check Fields Valid\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          912,\n          208\n        ]\n      },\n      {\n        \"parameters\": {\n          \"respondWith\": \"json\",\n          \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Bad Request\\\", \\\"message\\\": \\\"Missing required fields: \\\" + $json.validation.missingFields.join(', ') } }}\",\n          \"options\": {\n            \"responseCode\": 400\n          }\n        },\n        \"id\": \"respond-400\",\n        \"name\": \"Respond 400 Bad Request\",\n        \"type\": \"n8n-nodes-base.respondToWebhook\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          1152,\n          400\n        ]\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/rpc/deduct_credit\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ p_user_id: $('Validate Fields').item.json.body.user_id, p_video_id: $('Validate Fields').item.json.body.video_id }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-deduct-credit\",\n        \"name\": \"Deduct Credit\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          1152,\n          208\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const response = $input.first().json;\\nconst previousData = $('Validate Fields').item.json;\\nconst creditDeducted = response === true;\\nreturn [{ json: { ...previousData, creditDeducted: creditDeducted, startTime: Date.now() } }];\"\n        },\n        \"id\": \"code-check-credit\",\n        \"name\": \"Check Credit Result\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          1360,\n          208\n        ]\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"loose\"\n            },\n            \"combinator\": \"and\",\n            \"conditions\": [\n              {\n                \"id\": \"check-credit\",\n                \"leftValue\": \"={{ $json.creditDeducted }}\",\n                \"rightValue\": true,\n                \"operator\": {\n                  \"type\": \"boolean\",\n                  \"operation\": \"equals\"\n                }\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"if-credit-success\",\n        \"name\": \"Credit Deducted?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          1552,\n          208\n        ]\n      },\n      {\n        \"parameters\": {\n          \"respondWith\": \"json\",\n          \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Payment Required\\\", \\\"message\\\": \\\"Insufficient credits\\\" } }}\",\n          \"options\": {\n            \"responseCode\": 402\n          }\n        },\n        \"id\": \"respond-402\",\n        \"name\": \"Respond 402 No Credits\",\n        \"type\": \"n8n-nodes-base.respondToWebhook\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          1808,\n          352\n        ]\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"https://api.openai.com/v1/chat/completions\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer YOUR_OPENAI_API_KEY\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ model: 'gpt-4o-mini', messages: [{ role: 'system', content: 'Generate a detailed image prompt for product photography. Focus on lighting, angle, background, and mood. Keep under 150 words.' }, { role: 'user', content: 'Product: ' + $json.body.product_name + (($json.body.features || '') ? '. Features: ' + $json.body.features : '') }], max_tokens: 250, temperature: 0.7 }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-openai-image-prompt\",\n        \"name\": \"Generate Image Prompt\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          1808,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const openaiResp = $input.first().json;\\nconst prevData = $('Check Credit Result').item.json;\\nlet imagePrompt = '';\\nif (openaiResp.choices && openaiResp.choices[0]) {\\n  imagePrompt = openaiResp.choices[0].message.content.trim();\\n}\\nreturn [{ json: { ...prevData, imagePrompt: imagePrompt } }];\"\n        },\n        \"id\": \"code-extract-prompt\",\n        \"name\": \"Extract Image Prompt\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          2064,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"https://api.kie.ai/api/v1/flux/kontext/generate\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ prompt: $json.imagePrompt, aspectRatio: '1:1', outputFormat: 'jpeg', model: 'flux-kontext-pro' }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-kie-image\",\n        \"name\": \"Generate Image - KIE.AI\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          2304,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const kieResp = $input.first().json;\\nconst prevData = $('Extract Image Prompt').item.json;\\nlet imageTaskId = '';\\nif (kieResp.data && kieResp.data.taskId) {\\n  imageTaskId = kieResp.data.taskId;\\n}\\nreturn [{ json: { ...prevData, imageTaskId: imageTaskId, imageAttempts: 0 } }];\"\n        },\n        \"id\": \"code-get-image-task\",\n        \"name\": \"Get Image Task ID\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          2560,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"amount\": 10\n        },\n        \"id\": \"wait-image\",\n        \"name\": \"Wait for Image\",\n        \"type\": \"n8n-nodes-base.wait\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          2752,\n          112\n        ],\n        \"webhookId\": \"7c1301eb-0c78-4e91-81f5-65f243866455\"\n      },\n      {\n        \"parameters\": {\n          \"url\": \"={{ 'https://api.kie.ai/api/v1/flux/kontext/record-info?taskId=' + $json.imageTaskId }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n              }\n            ]\n          },\n          \"options\": {\n            \"timeout\": 60000,\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-poll-image\",\n        \"name\": \"Poll Image Status\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          2960,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const pollResp = $input.first().json;\\nconst prevData = $('Wait for Image').item.json;\\nlet imageUrl = '';\\nlet imageComplete = false;\\nlet hasError = false;\\nlet errorMessage = '';\\nlet attempts = (prevData.imageAttempts || 0) + 1;\\n\\n// Check for successful completion (KIE.AI format)\\nif (pollResp.data && pollResp.data.successFlag === 1) {\\n  // Image completed successfully\\n  if (pollResp.data.response && pollResp.data.response.resultImageUrl) {\\n    imageUrl = pollResp.data.response.resultImageUrl;\\n    imageComplete = true;\\n  }\\n} else if (pollResp.data && pollResp.data.errorCode) {\\n  // Image generation failed\\n  hasError = true;\\n  errorMessage = pollResp.data.errorMessage || 'Image generation failed';\\n  imageComplete = true;\\n}\\n\\n// Check for timeout\\nif (attempts >= 30 && !imageComplete) {\\n  hasError = true;\\n  errorMessage = 'Image generation timed out (5 minutes)';\\n  imageComplete = true;\\n}\\n\\n// Check for connection errors\\nif (!pollResp.data && attempts >= 30) {\\n  hasError = true;\\n  errorMessage = 'Polling failed - connection issues with KIE.AI';\\n  imageComplete = true;\\n}\\n\\nreturn [{ json: { ...prevData, generatedImageUrl: imageUrl, imageComplete: imageComplete, imageAttempts: attempts, hasImageError: hasError, imageErrorMessage: errorMessage } }];\\n\"\n        },\n        \"id\": \"code-check-image\",\n        \"name\": \"Check Image Status\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          3152,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"loose\"\n            },\n            \"combinator\": \"or\",\n            \"conditions\": [\n              {\n                \"id\": \"img-complete\",\n                \"leftValue\": \"={{ $json.imageComplete }}\",\n                \"rightValue\": true,\n                \"operator\": {\n                  \"type\": \"boolean\",\n                  \"operation\": \"equals\"\n                }\n              },\n              {\n                \"id\": \"max-attempts\",\n                \"leftValue\": \"={{ $json.imageAttempts }}\",\n                \"rightValue\": \"12\",\n                \"operator\": {\n                  \"type\": \"number\",\n                  \"operation\": \"gte\"\n                }\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"if-image-ready\",\n        \"name\": \"Image Ready?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          3360,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"https://api.openai.com/v1/chat/completions\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer YOUR_OPENAI_API_KEY\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ $json.hasImageError ? JSON.stringify({ model: 'gpt-4o-mini', messages: [{ role: 'user', content: 'ERROR: Image generation failed. Return empty video prompt.' }], max_tokens: 50 }) : JSON.stringify({ model: 'gpt-4o-mini', messages: [{ role: 'system', content: 'Describe this product image for a video ad. Focus on visual appeal, key features, and create an engaging video prompt. Keep under 100 words.' }, { role: 'user', content: [{ type: 'text', text: 'Describe this product image and create a video prompt for: ' + $json.body.product_name }, { type: 'image_url', image_url: { url: $json.generatedImageUrl || $json.body.product_photo_url } }] }], max_tokens: 200 }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-openai-vision\",\n        \"name\": \"Analyze Image - OpenAI\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          3600,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const visionResp = $input.first().json;\\nconst prevData = $('Check Image Status').item.json;\\nlet videoPrompt = '';\\nif (visionResp.choices && visionResp.choices[0]) {\\n  videoPrompt = visionResp.choices[0].message.content.trim();\\n}\\nreturn [{ json: { ...prevData, videoPrompt: videoPrompt } }];\"\n        },\n        \"id\": \"code-extract-video-prompt\",\n        \"name\": \"Extract Video Prompt\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          3856,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"https://api.kie.ai/api/v1/veo/generate\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ prompt: $json.videoPrompt, model: 'veo3_fast', aspect_ratio: '16:9', imageUrls: $json.generatedImageUrl ? [$json.generatedImageUrl] : [], generationType: $json.generatedImageUrl ? 'REFERENCE_2_VIDEO' : 'TEXT_2_VIDEO' }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-kie-video\",\n        \"name\": \"Generate Video - KIE.AI\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          4112,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const veoResp = $input.first().json;\\nconst prevData = $('Extract Video Prompt').item.json;\\nlet videoTaskId = '';\\nif (veoResp.data && veoResp.data.taskId) {\\n  videoTaskId = veoResp.data.taskId;\\n}\\nreturn [{ json: { ...prevData, videoTaskId: videoTaskId, videoAttempts: 0 } }];\"\n        },\n        \"id\": \"code-get-video-task\",\n        \"name\": \"Get Video Task ID\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          4352,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"amount\": 15\n        },\n        \"id\": \"wait-video\",\n        \"name\": \"Wait for Video\",\n        \"type\": \"n8n-nodes-base.wait\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          4560,\n          112\n        ],\n        \"webhookId\": \"bec85038-0690-4c62-b20a-29736d8f4889\"\n      },\n      {\n        \"parameters\": {\n          \"url\": \"={{ 'https://api.kie.ai/api/v1/jobs/recordInfo?taskId=' + $json.videoTaskId }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n              }\n            ]\n          },\n          \"options\": {\n            \"timeout\": 60000,\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-poll-video\",\n        \"name\": \"Poll Video Status\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          4752,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"jsCode\": \"const pollResp = $input.first().json;\\nconst prevData = $('Wait for Video').item.json;\\nlet videoUrl = '';\\nlet videoComplete = false;\\nlet hasError = false;\\nlet errorMessage = '';\\nlet attempts = (prevData.videoAttempts || 0) + 1;\\n\\n// Check for successful completion (KIE.AI format)\\nif (pollResp.data && pollResp.data.successFlag === 1) {\\n  // Video completed successfully\\n  if (pollResp.data.response) {\\n    // Try multiple possible field names for video URL\\n    videoUrl = pollResp.data.response.videoUrl || \\n               pollResp.data.response.resultVideoUrl || \\n               pollResp.data.response.video_url || \\n               '';\\n    \\n    // If we found a URL, mark as complete\\n    if (videoUrl) {\\n      videoComplete = true;\\n    }\\n  }\\n} else if (pollResp.data && pollResp.data.errorCode) {\\n  // Video generation failed\\n  hasError = true;\\n  errorMessage = pollResp.data.errorMessage || 'Video generation failed';\\n  videoComplete = true;\\n}\\n\\n// Check for timeout (10 minutes = 40 attempts x 15 seconds)\\nif (attempts >= 40 && !videoComplete) {\\n  hasError = true;\\n  errorMessage = 'Video generation timed out (10 minutes)';\\n  videoComplete = true;\\n}\\n\\n// Check for connection errors\\nif (!pollResp.data && attempts >= 40) {\\n  hasError = true;\\n  errorMessage = 'Polling failed - connection issues with KIE.AI';\\n  videoComplete = true;\\n}\\n\\nconst imageError = prevData.hasImageError || false;\\nconst imageErrorMsg = prevData.imageErrorMessage || '';\\n\\nreturn [{ json: { ...prevData, generatedVideoUrl: videoUrl, videoComplete: videoComplete, videoAttempts: attempts, hasVideoError: hasError, videoErrorMessage: errorMessage, hasImageError: imageError, imageErrorMessage: imageErrorMsg } }];\\n\"\n        },\n        \"id\": \"code-check-video\",\n        \"name\": \"Check Video Status\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          4960,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"loose\"\n            },\n            \"combinator\": \"or\",\n            \"conditions\": [\n              {\n                \"id\": \"vid-complete\",\n                \"leftValue\": \"={{ $json.videoComplete }}\",\n                \"rightValue\": true,\n                \"operator\": {\n                  \"type\": \"boolean\",\n                  \"operation\": \"equals\"\n                }\n              },\n              {\n                \"id\": \"max-vid-attempts\",\n                \"leftValue\": \"={{ $json.videoAttempts }}\",\n                \"rightValue\": \"20\",\n                \"operator\": {\n                  \"type\": \"number\",\n                  \"operation\": \"gte\"\n                }\n              }\n            ]\n          },\n          \"options\": {}\n        },\n        \"id\": \"if-video-ready\",\n        \"name\": \"Video Ready?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          5152,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"method\": \"PATCH\",\n          \"url\": \"={{ 'https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/videos?id=eq.' + $json.body.video_id }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              },\n              {\n                \"name\": \"Prefer\",\n                \"value\": \"return=minimal\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ status: ($json.hasImageError || $json.hasVideoError || !$json.videoComplete) ? 'failed' : 'completed', image_prompt: $json.imagePrompt, video_prompt: $json.videoPrompt, generated_image_url: $json.generatedImageUrl, generated_video_url: $json.generatedVideoUrl, error_message: $json.hasImageError ? $json.imageErrorMessage : ($json.hasVideoError ? $json.videoErrorMessage : null), completed_at: new Date().toISOString(), generation_time_seconds: Math.round((Date.now() - $json.startTime) / 1000) }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        },\n        \"id\": \"http-update-db\",\n        \"name\": \"Update Video Record\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          5408,\n          112\n        ]\n      },\n      {\n        \"parameters\": {\n          \"respondWith\": \"json\",\n          \"responseBody\": \"={{ { \\\"success\\\": !$json.needsRefund, \\\"message\\\": $json.needsRefund ? \\\"Video generation failed - credit refunded\\\" : \\\"Video generation completed\\\", \\\"credit_refunded\\\": $json.needsRefund || false, \\\"data\\\": { \\\"video_id\\\": $json.body.video_id, \\\"image_url\\\": $json.generatedImageUrl, \\\"video_url\\\": $json.generatedVideoUrl, \\\"image_prompt\\\": $json.imagePrompt, \\\"video_prompt\\\": $json.videoPrompt, \\\"generation_time_seconds\\\": Math.round((Date.now() - $json.startTime) / 1000), \\\"error\\\": $json.hasImageError ? $json.imageErrorMessage : ($json.hasVideoError ? $json.videoErrorMessage : null) } } }}\",\n          \"options\": {\n            \"responseCode\": \"={{ $json.needsRefund ? 500 : 200 }}\"\n          }\n        },\n        \"id\": \"respond-success\",\n        \"name\": \"Respond Success\",\n        \"type\": \"n8n-nodes-base.respondToWebhook\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          5664,\n          112\n        ]\n      },\n      {\n        \"id\": \"code-check-refund\",\n        \"name\": \"Check if Refund Needed\",\n        \"type\": \"n8n-nodes-base.code\",\n        \"typeVersion\": 2,\n        \"position\": [\n          5408,\n          300\n        ],\n        \"parameters\": {\n          \"jsCode\": \"const data = $input.first().json;\\nconst needsRefund = data.hasImageError || data.hasVideoError || !data.videoComplete;\\nreturn [{ json: { ...data, needsRefund: needsRefund } }];\"\n        }\n      },\n      {\n        \"id\": \"if-needs-refund\",\n        \"name\": \"Needs Refund?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          5600,\n          300\n        ],\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"strict\"\n            },\n            \"combinator\": \"and\",\n            \"conditions\": [\n              {\n                \"id\": \"check-refund\",\n                \"leftValue\": \"={{ $json.needsRefund }}\",\n                \"rightValue\": true,\n                \"operator\": {\n                  \"type\": \"boolean\",\n                  \"operation\": \"equals\"\n                }\n              }\n            ]\n          }\n        }\n      },\n      {\n        \"id\": \"http-do-refund\",\n        \"name\": \"Execute Refund\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          5850,\n          400\n        ],\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/rpc/refund_credit\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ p_user_id: $('Validate Fields').item.json.body.user_id, p_video_id: $('Validate Fields').item.json.body.video_id }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        }\n      },\n      {\n        \"id\": \"if-image-has-error\",\n        \"name\": \"Image Generation Failed?\",\n        \"type\": \"n8n-nodes-base.if\",\n        \"typeVersion\": 2.2,\n        \"position\": [\n          3600,\n          300\n        ],\n        \"parameters\": {\n          \"conditions\": {\n            \"options\": {\n              \"version\": 2,\n              \"leftValue\": \"\",\n              \"caseSensitive\": true,\n              \"typeValidation\": \"strict\"\n            },\n            \"combinator\": \"and\",\n            \"conditions\": [\n              {\n                \"id\": \"check-error\",\n                \"leftValue\": \"={{ $json.hasImageError }}\",\n                \"rightValue\": true,\n                \"operator\": {\n                  \"type\": \"boolean\",\n                  \"operation\": \"equals\"\n                }\n              }\n            ]\n          }\n        }\n      },\n      {\n        \"id\": \"http-update-failed-image\",\n        \"name\": \"Update Failed Status\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          3850,\n          400\n        ],\n        \"parameters\": {\n          \"method\": \"PATCH\",\n          \"url\": \"={{ 'https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/videos?id=eq.' + $json.body.video_id }}\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              },\n              {\n                \"name\": \"Prefer\",\n                \"value\": \"return=minimal\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ status: 'failed', error_message: $json.imageErrorMessage, image_prompt: $json.imagePrompt, completed_at: new Date().toISOString(), generation_time_seconds: Math.round((Date.now() - $json.startTime) / 1000) }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        }\n      },\n      {\n        \"id\": \"http-refund-image-fail\",\n        \"name\": \"Refund Credit (Image Failed)\",\n        \"type\": \"n8n-nodes-base.httpRequest\",\n        \"typeVersion\": 4.2,\n        \"position\": [\n          4100,\n          400\n        ],\n        \"parameters\": {\n          \"method\": \"POST\",\n          \"url\": \"https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/rpc/refund_credit\",\n          \"sendHeaders\": true,\n          \"headerParameters\": {\n            \"parameters\": [\n              {\n                \"name\": \"apikey\",\n                \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Authorization\",\n                \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n              },\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/json\"\n              }\n            ]\n          },\n          \"sendBody\": true,\n          \"specifyBody\": \"json\",\n          \"jsonBody\": \"={{ JSON.stringify({ p_user_id: $('Validate Fields').item.json.body.user_id, p_video_id: $('Validate Fields').item.json.body.video_id }) }}\",\n          \"options\": {\n            \"response\": {\n              \"response\": {\n                \"neverError\": true\n              }\n            }\n          }\n        }\n      },\n      {\n        \"id\": \"respond-image-failed\",\n        \"name\": \"Respond Image Failed\",\n        \"type\": \"n8n-nodes-base.respondToWebhook\",\n        \"typeVersion\": 1.1,\n        \"position\": [\n          4350,\n          400\n        ],\n        \"parameters\": {\n          \"respondWith\": \"json\",\n          \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Image Generation Failed\\\", \\\"message\\\": $json.imageErrorMessage, \\\"credit_refunded\\\": true } }}\",\n          \"options\": {\n            \"responseCode\": 500\n          }\n        }\n      }\n    ],\n    \"connections\": {\n      \"Webhook Trigger\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Validate API Key\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Validate API Key\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Validate Fields\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Respond 401 Unauthorized\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Validate Fields\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Check Fields Valid\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Check Fields Valid\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Deduct Credit\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Respond 400 Bad Request\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Deduct Credit\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Check Credit Result\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Check Credit Result\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Credit Deducted?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Credit Deducted?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Generate Image Prompt\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Respond 402 No Credits\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Generate Image Prompt\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Extract Image Prompt\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Extract Image Prompt\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Generate Image - KIE.AI\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Generate Image - KIE.AI\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Get Image Task ID\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Get Image Task ID\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Wait for Image\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Wait for Image\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Poll Image Status\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Poll Image Status\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Check Image Status\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Check Image Status\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Image Ready?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Image Ready?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Image Generation Failed?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Wait for Image\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Analyze Image - OpenAI\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Extract Video Prompt\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Extract Video Prompt\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Generate Video - KIE.AI\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Generate Video - KIE.AI\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Get Video Task ID\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Get Video Task ID\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Wait for Video\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Wait for Video\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Poll Video Status\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Poll Video Status\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Check Video Status\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Check Video Status\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Video Ready?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Video Ready?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Update Video Record\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Wait for Video\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Update Video Record\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Check if Refund Needed\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Check if Refund Needed\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Needs Refund?\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Needs Refund?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Execute Refund\",\n              \"type\": \"main\",\n              \"index\": 0\n            },\n            {\n              \"node\": \"Respond Success\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Execute Refund\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Respond Success\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Image Generation Failed?\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Update Failed Status\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ],\n          [\n            {\n              \"node\": \"Analyze Image - OpenAI\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Update Failed Status\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Refund Credit (Image Failed)\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      },\n      \"Refund Credit (Image Failed)\": {\n        \"main\": [\n          [\n            {\n              \"node\": \"Respond Image Failed\",\n              \"type\": \"main\",\n              \"index\": 0\n            }\n          ]\n        ]\n      }\n    },\n    \"settings\": {\n      \"executionOrder\": \"v1\",\n      \"callerPolicy\": \"workflowsFromSameOwner\",\n      \"availableInMCP\": false\n    },\n    \"staticData\": null,\n    \"meta\": null,\n    \"pinData\": {\n      \"Webhook Trigger\": [\n        {\n          \"json\": {\n            \"headers\": {\n              \"host\": \"n8n.sam9scloud.in\",\n              \"user-agent\": \"curl/8.15.0\",\n              \"content-length\": \"241\",\n              \"accept\": \"*/*\",\n              \"content-type\": \"application/json\",\n              \"via\": \"1.1 Caddy\",\n              \"x-api-key\": \"nHChN19vbgeSPiDMkfQWsmZ3u2TcBK6y\",\n              \"x-forwarded-for\": \"106.219.156.81\",\n              \"x-forwarded-host\": \"n8n.sam9scloud.in\",\n              \"x-forwarded-proto\": \"https\",\n              \"accept-encoding\": \"gzip\"\n            },\n            \"params\": {},\n            \"query\": {},\n            \"body\": {\n              \"user_id\": \"42a140a2-b4c5-4e2e-92bd-449e87f52605\",\n              \"video_id\": \"9f927071-cecf-45f8-9019-54ad67b236e2\",\n              \"product_name\": \"Premium Wireless Headphones\",\n              \"product_photo_url\": \"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500\"\n            },\n            \"webhookUrl\": \"https://n8n.sam9scloud.in/webhook/ugc-video-generate\",\n            \"executionMode\": \"production\"\n          },\n          \"pairedItem\": {\n            \"item\": 0\n          }\n        }\n      ]\n    },\n    \"versionId\": \"334f2b39-a5ce-402d-9dcf-b5ab42b0d3c9\",\n    \"activeVersionId\": \"334f2b39-a5ce-402d-9dcf-b5ab42b0d3c9\",\n    \"versionCounter\": 102,\n    \"triggerCount\": 1,\n    \"shared\": [\n      {\n        \"updatedAt\": \"2026-01-17T07:45:26.423Z\",\n        \"createdAt\": \"2026-01-17T07:45:26.423Z\",\n        \"role\": \"workflow:owner\",\n        \"workflowId\": \"MTcFgM1Ym9WnYZ2Y\",\n        \"projectId\": \"qAt327iSczqH51SY\",\n        \"project\": {\n          \"updatedAt\": \"2025-09-15T13:05:26.285Z\",\n          \"createdAt\": \"2025-09-15T13:04:27.625Z\",\n          \"id\": \"qAt327iSczqH51SY\",\n          \"name\": \"Sammy Singh <sam27sep@gmail.com>\",\n          \"type\": \"personal\",\n          \"icon\": null,\n          \"description\": null,\n          \"creatorId\": \"eb430822-a0a8-47bb-92c3-4cbd8f1cbc58\",\n          \"projectRelations\": [\n            {\n              \"updatedAt\": \"2025-09-15T13:04:27.626Z\",\n              \"createdAt\": \"2025-09-15T13:04:27.626Z\",\n              \"userId\": \"eb430822-a0a8-47bb-92c3-4cbd8f1cbc58\",\n              \"projectId\": \"qAt327iSczqH51SY\",\n              \"user\": {\n                \"updatedAt\": \"2026-01-18T00:51:42.000Z\",\n                \"createdAt\": \"2025-09-15T13:04:27.118Z\",\n                \"id\": \"eb430822-a0a8-47bb-92c3-4cbd8f1cbc58\",\n                \"email\": \"sam27sep@gmail.com\",\n                \"firstName\": \"Sammy\",\n                \"lastName\": \"Singh\",\n                \"personalizationAnswers\": null,\n                \"settings\": {\n                  \"userActivated\": true,\n                  \"easyAIWorkflowOnboarded\": true,\n                  \"firstSuccessfulWorkflowId\": \"cHL7Y4KcXuF3rvNL\",\n                  \"userActivatedAt\": 1759501222166\n                },\n                \"disabled\": false,\n                \"mfaEnabled\": false,\n                \"lastActiveAt\": \"2026-01-18\",\n                \"isPending\": false\n              }\n            }\n          ]\n        }\n      }\n    ],\n    \"tags\": [],\n    \"activeVersion\": {\n      \"updatedAt\": \"2026-01-18T05:55:05.352Z\",\n      \"createdAt\": \"2026-01-18T05:55:05.352Z\",\n      \"versionId\": \"334f2b39-a5ce-402d-9dcf-b5ab42b0d3c9\",\n      \"workflowId\": \"MTcFgM1Ym9WnYZ2Y\",\n      \"nodes\": [\n        {\n          \"parameters\": {\n            \"httpMethod\": \"POST\",\n            \"path\": \"ugc-video-generate\",\n            \"responseMode\": \"responseNode\",\n            \"options\": {}\n          },\n          \"id\": \"webhook-trigger\",\n          \"name\": \"Webhook Trigger\",\n          \"type\": \"n8n-nodes-base.webhook\",\n          \"typeVersion\": 2,\n          \"position\": [\n            256,\n            304\n          ],\n          \"webhookId\": \"ugc-video-generate\"\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"strict\"\n              },\n              \"combinator\": \"and\",\n              \"conditions\": [\n                {\n                  \"id\": \"api-key-check\",\n                  \"leftValue\": \"={{ $json.headers['x-api-key'] }}\",\n                  \"rightValue\": \"nHChN19vbgeSPiDMkfQWsmZ3u2TcBK6y\",\n                  \"operator\": {\n                    \"type\": \"string\",\n                    \"operation\": \"equals\"\n                  }\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"validate-api-key\",\n          \"name\": \"Validate API Key\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            464,\n            304\n          ]\n        },\n        {\n          \"parameters\": {\n            \"respondWith\": \"json\",\n            \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Unauthorized\\\", \\\"message\\\": \\\"Invalid or missing X-API-Key header\\\" } }}\",\n            \"options\": {\n              \"responseCode\": 401\n            }\n          },\n          \"id\": \"respond-401\",\n          \"name\": \"Respond 401 Unauthorized\",\n          \"type\": \"n8n-nodes-base.respondToWebhook\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            704,\n            512\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const body = $input.first().json.body || {};\\nconst requiredFields = ['user_id', 'video_id', 'product_name', 'product_photo_url'];\\nconst missingFields = requiredFields.filter(field => {\\n  const value = body[field];\\n  return value === undefined || value === null || value === '';\\n});\\nreturn [{\\n  json: {\\n    ...$input.first().json,\\n    validation: { isValid: missingFields.length === 0, missingFields: missingFields }\\n  }\\n}];\"\n          },\n          \"id\": \"code-validate-fields\",\n          \"name\": \"Validate Fields\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            704,\n            208\n          ]\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"loose\"\n              },\n              \"combinator\": \"and\",\n              \"conditions\": [\n                {\n                  \"id\": \"check-valid\",\n                  \"leftValue\": \"={{ $json.validation.isValid }}\",\n                  \"rightValue\": true,\n                  \"operator\": {\n                    \"type\": \"boolean\",\n                    \"operation\": \"equals\"\n                  }\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"if-fields-valid\",\n          \"name\": \"Check Fields Valid\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            912,\n            208\n          ]\n        },\n        {\n          \"parameters\": {\n            \"respondWith\": \"json\",\n            \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Bad Request\\\", \\\"message\\\": \\\"Missing required fields: \\\" + $json.validation.missingFields.join(', ') } }}\",\n            \"options\": {\n              \"responseCode\": 400\n            }\n          },\n          \"id\": \"respond-400\",\n          \"name\": \"Respond 400 Bad Request\",\n          \"type\": \"n8n-nodes-base.respondToWebhook\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            1152,\n            400\n          ]\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/rpc/deduct_credit\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ p_user_id: $('Validate Fields').item.json.body.user_id, p_video_id: $('Validate Fields').item.json.body.video_id }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-deduct-credit\",\n          \"name\": \"Deduct Credit\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            1152,\n            208\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const response = $input.first().json;\\nconst previousData = $('Validate Fields').item.json;\\nconst creditDeducted = response === true;\\nreturn [{ json: { ...previousData, creditDeducted: creditDeducted, startTime: Date.now() } }];\"\n          },\n          \"id\": \"code-check-credit\",\n          \"name\": \"Check Credit Result\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            1360,\n            208\n          ]\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"loose\"\n              },\n              \"combinator\": \"and\",\n              \"conditions\": [\n                {\n                  \"id\": \"check-credit\",\n                  \"leftValue\": \"={{ $json.creditDeducted }}\",\n                  \"rightValue\": true,\n                  \"operator\": {\n                    \"type\": \"boolean\",\n                    \"operation\": \"equals\"\n                  }\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"if-credit-success\",\n          \"name\": \"Credit Deducted?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            1552,\n            208\n          ]\n        },\n        {\n          \"parameters\": {\n            \"respondWith\": \"json\",\n            \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Payment Required\\\", \\\"message\\\": \\\"Insufficient credits\\\" } }}\",\n            \"options\": {\n              \"responseCode\": 402\n            }\n          },\n          \"id\": \"respond-402\",\n          \"name\": \"Respond 402 No Credits\",\n          \"type\": \"n8n-nodes-base.respondToWebhook\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            1808,\n            352\n          ]\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"https://api.openai.com/v1/chat/completions\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer YOUR_OPENAI_API_KEY\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ model: 'gpt-4o-mini', messages: [{ role: 'system', content: 'Generate a detailed image prompt for product photography. Focus on lighting, angle, background, and mood. Keep under 150 words.' }, { role: 'user', content: 'Product: ' + $json.body.product_name + (($json.body.features || '') ? '. Features: ' + $json.body.features : '') }], max_tokens: 250, temperature: 0.7 }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-openai-image-prompt\",\n          \"name\": \"Generate Image Prompt\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            1808,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const openaiResp = $input.first().json;\\nconst prevData = $('Check Credit Result').item.json;\\nlet imagePrompt = '';\\nif (openaiResp.choices && openaiResp.choices[0]) {\\n  imagePrompt = openaiResp.choices[0].message.content.trim();\\n}\\nreturn [{ json: { ...prevData, imagePrompt: imagePrompt } }];\"\n          },\n          \"id\": \"code-extract-prompt\",\n          \"name\": \"Extract Image Prompt\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            2064,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"https://api.kie.ai/api/v1/flux/kontext/generate\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ prompt: $json.imagePrompt, aspectRatio: '1:1', outputFormat: 'jpeg', model: 'flux-kontext-pro' }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-kie-image\",\n          \"name\": \"Generate Image - KIE.AI\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            2304,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const kieResp = $input.first().json;\\nconst prevData = $('Extract Image Prompt').item.json;\\nlet imageTaskId = '';\\nif (kieResp.data && kieResp.data.taskId) {\\n  imageTaskId = kieResp.data.taskId;\\n}\\nreturn [{ json: { ...prevData, imageTaskId: imageTaskId, imageAttempts: 0 } }];\"\n          },\n          \"id\": \"code-get-image-task\",\n          \"name\": \"Get Image Task ID\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            2560,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"amount\": 10\n          },\n          \"id\": \"wait-image\",\n          \"name\": \"Wait for Image\",\n          \"type\": \"n8n-nodes-base.wait\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            2752,\n            112\n          ],\n          \"webhookId\": \"7c1301eb-0c78-4e91-81f5-65f243866455\"\n        },\n        {\n          \"parameters\": {\n            \"url\": \"={{ 'https://api.kie.ai/api/v1/flux/kontext/record-info?taskId=' + $json.imageTaskId }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n                }\n              ]\n            },\n            \"options\": {\n              \"timeout\": 60000,\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-poll-image\",\n          \"name\": \"Poll Image Status\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            2960,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const pollResp = $input.first().json;\\nconst prevData = $('Wait for Image').item.json;\\nlet imageUrl = '';\\nlet imageComplete = false;\\nlet hasError = false;\\nlet errorMessage = '';\\nlet attempts = (prevData.imageAttempts || 0) + 1;\\n\\n// Check for successful completion (KIE.AI format)\\nif (pollResp.data && pollResp.data.successFlag === 1) {\\n  // Image completed successfully\\n  if (pollResp.data.response && pollResp.data.response.resultImageUrl) {\\n    imageUrl = pollResp.data.response.resultImageUrl;\\n    imageComplete = true;\\n  }\\n} else if (pollResp.data && pollResp.data.errorCode) {\\n  // Image generation failed\\n  hasError = true;\\n  errorMessage = pollResp.data.errorMessage || 'Image generation failed';\\n  imageComplete = true;\\n}\\n\\n// Check for timeout\\nif (attempts >= 30 && !imageComplete) {\\n  hasError = true;\\n  errorMessage = 'Image generation timed out (5 minutes)';\\n  imageComplete = true;\\n}\\n\\n// Check for connection errors\\nif (!pollResp.data && attempts >= 30) {\\n  hasError = true;\\n  errorMessage = 'Polling failed - connection issues with KIE.AI';\\n  imageComplete = true;\\n}\\n\\nreturn [{ json: { ...prevData, generatedImageUrl: imageUrl, imageComplete: imageComplete, imageAttempts: attempts, hasImageError: hasError, imageErrorMessage: errorMessage } }];\\n\"\n          },\n          \"id\": \"code-check-image\",\n          \"name\": \"Check Image Status\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            3152,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"loose\"\n              },\n              \"combinator\": \"or\",\n              \"conditions\": [\n                {\n                  \"id\": \"img-complete\",\n                  \"leftValue\": \"={{ $json.imageComplete }}\",\n                  \"rightValue\": true,\n                  \"operator\": {\n                    \"type\": \"boolean\",\n                    \"operation\": \"equals\"\n                  }\n                },\n                {\n                  \"id\": \"max-attempts\",\n                  \"leftValue\": \"={{ $json.imageAttempts }}\",\n                  \"rightValue\": \"12\",\n                  \"operator\": {\n                    \"type\": \"number\",\n                    \"operation\": \"gte\"\n                  }\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"if-image-ready\",\n          \"name\": \"Image Ready?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            3360,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"https://api.openai.com/v1/chat/completions\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer YOUR_OPENAI_API_KEY\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ $json.hasImageError ? JSON.stringify({ model: 'gpt-4o-mini', messages: [{ role: 'user', content: 'ERROR: Image generation failed. Return empty video prompt.' }], max_tokens: 50 }) : JSON.stringify({ model: 'gpt-4o-mini', messages: [{ role: 'system', content: 'Describe this product image for a video ad. Focus on visual appeal, key features, and create an engaging video prompt. Keep under 100 words.' }, { role: 'user', content: [{ type: 'text', text: 'Describe this product image and create a video prompt for: ' + $json.body.product_name }, { type: 'image_url', image_url: { url: $json.generatedImageUrl || $json.body.product_photo_url } }] }], max_tokens: 200 }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-openai-vision\",\n          \"name\": \"Analyze Image - OpenAI\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            3600,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const visionResp = $input.first().json;\\nconst prevData = $('Check Image Status').item.json;\\nlet videoPrompt = '';\\nif (visionResp.choices && visionResp.choices[0]) {\\n  videoPrompt = visionResp.choices[0].message.content.trim();\\n}\\nreturn [{ json: { ...prevData, videoPrompt: videoPrompt } }];\"\n          },\n          \"id\": \"code-extract-video-prompt\",\n          \"name\": \"Extract Video Prompt\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            3856,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"https://api.kie.ai/api/v1/veo/generate\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ prompt: $json.videoPrompt, model: 'veo3_fast', aspect_ratio: '16:9', imageUrls: $json.generatedImageUrl ? [$json.generatedImageUrl] : [], generationType: $json.generatedImageUrl ? 'REFERENCE_2_VIDEO' : 'TEXT_2_VIDEO' }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-kie-video\",\n          \"name\": \"Generate Video - KIE.AI\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            4112,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const veoResp = $input.first().json;\\nconst prevData = $('Extract Video Prompt').item.json;\\nlet videoTaskId = '';\\nif (veoResp.data && veoResp.data.taskId) {\\n  videoTaskId = veoResp.data.taskId;\\n}\\nreturn [{ json: { ...prevData, videoTaskId: videoTaskId, videoAttempts: 0 } }];\"\n          },\n          \"id\": \"code-get-video-task\",\n          \"name\": \"Get Video Task ID\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            4352,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"amount\": 15\n          },\n          \"id\": \"wait-video\",\n          \"name\": \"Wait for Video\",\n          \"type\": \"n8n-nodes-base.wait\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            4560,\n            112\n          ],\n          \"webhookId\": \"bec85038-0690-4c62-b20a-29736d8f4889\"\n        },\n        {\n          \"parameters\": {\n            \"url\": \"={{ 'https://api.kie.ai/api/v1/jobs/recordInfo?taskId=' + $json.videoTaskId }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer YOUR_KIE_AI_API_KEY\"\n                }\n              ]\n            },\n            \"options\": {\n              \"timeout\": 60000,\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-poll-video\",\n          \"name\": \"Poll Video Status\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            4752,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"jsCode\": \"const pollResp = $input.first().json;\\nconst prevData = $('Wait for Video').item.json;\\nlet videoUrl = '';\\nlet videoComplete = false;\\nlet hasError = false;\\nlet errorMessage = '';\\nlet attempts = (prevData.videoAttempts || 0) + 1;\\n\\n// Check for successful completion (KIE.AI format)\\nif (pollResp.data && pollResp.data.successFlag === 1) {\\n  // Video completed successfully\\n  if (pollResp.data.response) {\\n    // Try multiple possible field names for video URL\\n    videoUrl = pollResp.data.response.videoUrl || \\n               pollResp.data.response.resultVideoUrl || \\n               pollResp.data.response.video_url || \\n               '';\\n    \\n    // If we found a URL, mark as complete\\n    if (videoUrl) {\\n      videoComplete = true;\\n    }\\n  }\\n} else if (pollResp.data && pollResp.data.errorCode) {\\n  // Video generation failed\\n  hasError = true;\\n  errorMessage = pollResp.data.errorMessage || 'Video generation failed';\\n  videoComplete = true;\\n}\\n\\n// Check for timeout (10 minutes = 40 attempts x 15 seconds)\\nif (attempts >= 40 && !videoComplete) {\\n  hasError = true;\\n  errorMessage = 'Video generation timed out (10 minutes)';\\n  videoComplete = true;\\n}\\n\\n// Check for connection errors\\nif (!pollResp.data && attempts >= 40) {\\n  hasError = true;\\n  errorMessage = 'Polling failed - connection issues with KIE.AI';\\n  videoComplete = true;\\n}\\n\\nconst imageError = prevData.hasImageError || false;\\nconst imageErrorMsg = prevData.imageErrorMessage || '';\\n\\nreturn [{ json: { ...prevData, generatedVideoUrl: videoUrl, videoComplete: videoComplete, videoAttempts: attempts, hasVideoError: hasError, videoErrorMessage: errorMessage, hasImageError: imageError, imageErrorMessage: imageErrorMsg } }];\\n\"\n          },\n          \"id\": \"code-check-video\",\n          \"name\": \"Check Video Status\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            4960,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"loose\"\n              },\n              \"combinator\": \"or\",\n              \"conditions\": [\n                {\n                  \"id\": \"vid-complete\",\n                  \"leftValue\": \"={{ $json.videoComplete }}\",\n                  \"rightValue\": true,\n                  \"operator\": {\n                    \"type\": \"boolean\",\n                    \"operation\": \"equals\"\n                  }\n                },\n                {\n                  \"id\": \"max-vid-attempts\",\n                  \"leftValue\": \"={{ $json.videoAttempts }}\",\n                  \"rightValue\": \"20\",\n                  \"operator\": {\n                    \"type\": \"number\",\n                    \"operation\": \"gte\"\n                  }\n                }\n              ]\n            },\n            \"options\": {}\n          },\n          \"id\": \"if-video-ready\",\n          \"name\": \"Video Ready?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            5152,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"method\": \"PATCH\",\n            \"url\": \"={{ 'https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/videos?id=eq.' + $json.body.video_id }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                },\n                {\n                  \"name\": \"Prefer\",\n                  \"value\": \"return=minimal\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ status: ($json.hasImageError || $json.hasVideoError || !$json.videoComplete) ? 'failed' : 'completed', image_prompt: $json.imagePrompt, video_prompt: $json.videoPrompt, generated_image_url: $json.generatedImageUrl, generated_video_url: $json.generatedVideoUrl, error_message: $json.hasImageError ? $json.imageErrorMessage : ($json.hasVideoError ? $json.videoErrorMessage : null), completed_at: new Date().toISOString(), generation_time_seconds: Math.round((Date.now() - $json.startTime) / 1000) }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          },\n          \"id\": \"http-update-db\",\n          \"name\": \"Update Video Record\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            5408,\n            112\n          ]\n        },\n        {\n          \"parameters\": {\n            \"respondWith\": \"json\",\n            \"responseBody\": \"={{ { \\\"success\\\": !$json.needsRefund, \\\"message\\\": $json.needsRefund ? \\\"Video generation failed - credit refunded\\\" : \\\"Video generation completed\\\", \\\"credit_refunded\\\": $json.needsRefund || false, \\\"data\\\": { \\\"video_id\\\": $json.body.video_id, \\\"image_url\\\": $json.generatedImageUrl, \\\"video_url\\\": $json.generatedVideoUrl, \\\"image_prompt\\\": $json.imagePrompt, \\\"video_prompt\\\": $json.videoPrompt, \\\"generation_time_seconds\\\": Math.round((Date.now() - $json.startTime) / 1000), \\\"error\\\": $json.hasImageError ? $json.imageErrorMessage : ($json.hasVideoError ? $json.videoErrorMessage : null) } } }}\",\n            \"options\": {\n              \"responseCode\": \"={{ $json.needsRefund ? 500 : 200 }}\"\n            }\n          },\n          \"id\": \"respond-success\",\n          \"name\": \"Respond Success\",\n          \"type\": \"n8n-nodes-base.respondToWebhook\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            5664,\n            112\n          ]\n        },\n        {\n          \"id\": \"code-check-refund\",\n          \"name\": \"Check if Refund Needed\",\n          \"type\": \"n8n-nodes-base.code\",\n          \"typeVersion\": 2,\n          \"position\": [\n            5408,\n            300\n          ],\n          \"parameters\": {\n            \"jsCode\": \"const data = $input.first().json;\\nconst needsRefund = data.hasImageError || data.hasVideoError || !data.videoComplete;\\nreturn [{ json: { ...data, needsRefund: needsRefund } }];\"\n          }\n        },\n        {\n          \"id\": \"if-needs-refund\",\n          \"name\": \"Needs Refund?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            5600,\n            300\n          ],\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"strict\"\n              },\n              \"combinator\": \"and\",\n              \"conditions\": [\n                {\n                  \"id\": \"check-refund\",\n                  \"leftValue\": \"={{ $json.needsRefund }}\",\n                  \"rightValue\": true,\n                  \"operator\": {\n                    \"type\": \"boolean\",\n                    \"operation\": \"equals\"\n                  }\n                }\n              ]\n            }\n          }\n        },\n        {\n          \"id\": \"http-do-refund\",\n          \"name\": \"Execute Refund\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            5850,\n            400\n          ],\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/rpc/refund_credit\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ p_user_id: $('Validate Fields').item.json.body.user_id, p_video_id: $('Validate Fields').item.json.body.video_id }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          }\n        },\n        {\n          \"id\": \"if-image-has-error\",\n          \"name\": \"Image Generation Failed?\",\n          \"type\": \"n8n-nodes-base.if\",\n          \"typeVersion\": 2.2,\n          \"position\": [\n            3600,\n            300\n          ],\n          \"parameters\": {\n            \"conditions\": {\n              \"options\": {\n                \"version\": 2,\n                \"leftValue\": \"\",\n                \"caseSensitive\": true,\n                \"typeValidation\": \"strict\"\n              },\n              \"combinator\": \"and\",\n              \"conditions\": [\n                {\n                  \"id\": \"check-error\",\n                  \"leftValue\": \"={{ $json.hasImageError }}\",\n                  \"rightValue\": true,\n                  \"operator\": {\n                    \"type\": \"boolean\",\n                    \"operation\": \"equals\"\n                  }\n                }\n              ]\n            }\n          }\n        },\n        {\n          \"id\": \"http-update-failed-image\",\n          \"name\": \"Update Failed Status\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            3850,\n            400\n          ],\n          \"parameters\": {\n            \"method\": \"PATCH\",\n            \"url\": \"={{ 'https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/videos?id=eq.' + $json.body.video_id }}\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                },\n                {\n                  \"name\": \"Prefer\",\n                  \"value\": \"return=minimal\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ status: 'failed', error_message: $json.imageErrorMessage, image_prompt: $json.imagePrompt, completed_at: new Date().toISOString(), generation_time_seconds: Math.round((Date.now() - $json.startTime) / 1000) }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          }\n        },\n        {\n          \"id\": \"http-refund-image-fail\",\n          \"name\": \"Refund Credit (Image Failed)\",\n          \"type\": \"n8n-nodes-base.httpRequest\",\n          \"typeVersion\": 4.2,\n          \"position\": [\n            4100,\n            400\n          ],\n          \"parameters\": {\n            \"method\": \"POST\",\n            \"url\": \"https://crgbmbotbmzfibzupdhi.supabase.co/rest/v1/rpc/refund_credit\",\n            \"sendHeaders\": true,\n            \"headerParameters\": {\n              \"parameters\": [\n                {\n                  \"name\": \"apikey\",\n                  \"value\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Authorization\",\n                  \"value\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZ2JtYm90Ym16ZmlienVwZGhpIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODYyNTMxNSwiZXhwIjoyMDg0MjAxMzE1fQ.JMggYZASCwZIQY-HGYbZY33eDAm4ZcfJI8LChUuJ7gg\"\n                },\n                {\n                  \"name\": \"Content-Type\",\n                  \"value\": \"application/json\"\n                }\n              ]\n            },\n            \"sendBody\": true,\n            \"specifyBody\": \"json\",\n            \"jsonBody\": \"={{ JSON.stringify({ p_user_id: $('Validate Fields').item.json.body.user_id, p_video_id: $('Validate Fields').item.json.body.video_id }) }}\",\n            \"options\": {\n              \"response\": {\n                \"response\": {\n                  \"neverError\": true\n                }\n              }\n            }\n          }\n        },\n        {\n          \"id\": \"respond-image-failed\",\n          \"name\": \"Respond Image Failed\",\n          \"type\": \"n8n-nodes-base.respondToWebhook\",\n          \"typeVersion\": 1.1,\n          \"position\": [\n            4350,\n            400\n          ],\n          \"parameters\": {\n            \"respondWith\": \"json\",\n            \"responseBody\": \"={{ { \\\"success\\\": false, \\\"error\\\": \\\"Image Generation Failed\\\", \\\"message\\\": $json.imageErrorMessage, \\\"credit_refunded\\\": true } }}\",\n            \"options\": {\n              \"responseCode\": 500\n            }\n          }\n        }\n      ],\n      \"connections\": {\n        \"Webhook Trigger\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Validate API Key\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Validate API Key\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Validate Fields\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Respond 401 Unauthorized\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Validate Fields\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Check Fields Valid\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Check Fields Valid\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Deduct Credit\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Respond 400 Bad Request\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Deduct Credit\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Check Credit Result\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Check Credit Result\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Credit Deducted?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Credit Deducted?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Generate Image Prompt\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Respond 402 No Credits\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Generate Image Prompt\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Extract Image Prompt\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Extract Image Prompt\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Generate Image - KIE.AI\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Generate Image - KIE.AI\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Get Image Task ID\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Get Image Task ID\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Wait for Image\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Wait for Image\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Poll Image Status\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Poll Image Status\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Check Image Status\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Check Image Status\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Image Ready?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Image Ready?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Image Generation Failed?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Wait for Image\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Analyze Image - OpenAI\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Extract Video Prompt\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Extract Video Prompt\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Generate Video - KIE.AI\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Generate Video - KIE.AI\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Get Video Task ID\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Get Video Task ID\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Wait for Video\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Wait for Video\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Poll Video Status\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Poll Video Status\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Check Video Status\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Check Video Status\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Video Ready?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Video Ready?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Update Video Record\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Wait for Video\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Update Video Record\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Check if Refund Needed\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Check if Refund Needed\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Needs Refund?\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Needs Refund?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Execute Refund\",\n                \"type\": \"main\",\n                \"index\": 0\n              },\n              {\n                \"node\": \"Respond Success\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Execute Refund\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Respond Success\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Image Generation Failed?\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Update Failed Status\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ],\n            [\n              {\n                \"node\": \"Analyze Image - OpenAI\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Update Failed Status\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Refund Credit (Image Failed)\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        },\n        \"Refund Credit (Image Failed)\": {\n          \"main\": [\n            [\n              {\n                \"node\": \"Respond Image Failed\",\n                \"type\": \"main\",\n                \"index\": 0\n              }\n            ]\n          ]\n        }\n      },\n      \"authors\": \"Sammy Singh\",\n      \"name\": null,\n      \"description\": null,\n      \"autosaved\": false,\n      \"workflowPublishHistory\": [\n        {\n          \"createdAt\": \"2026-01-18T05:55:05.398Z\",\n          \"id\": 36,\n          \"workflowId\": \"MTcFgM1Ym9WnYZ2Y\",\n          \"versionId\": \"334f2b39-a5ce-402d-9dcf-b5ab42b0d3c9\",\n          \"event\": \"activated\",\n          \"userId\": \"eb430822-a0a8-47bb-92c3-4cbd8f1cbc58\"\n        }\n      ]\n    }\n  }\n}"
  }
